<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Desbroces Pontevedra</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
</head>
<body>

  <div class="container">
    <!-- Sección principal: ¿Quiénes somos? -->
    <div class="row">
      <div class="col-md-8 mb-5">
        <h2>¿Quiénes somos?</h2>
        <hr />
        <p>
          En <strong>Desbroces Pontevedra</strong> nos especializamos en la limpieza y mantenimiento de fincas, jardines y montes en toda la provincia. 
          Ofrecemos soluciones rápidas, eficaces y seguras tanto a particulares como a empresas.
        </p>
        <p>
          Contamos con maquinaria profesional y un equipo cualificado que garantiza resultados óptimos, ya sea para preparar un terreno, conservarlo o ponerlo a la venta.
        </p>
        <a class="btn btn-primary btn-lg" href="#servicios">Ver Servicios &raquo;</a>
      </div>
    </div>

    <!-- Sección de Servicios -->
    <div class="row" id="servicios">
      <!-- Servicios de la empresa como antes -->
    </div>

    <!-- Sección de contacto -->
    <div id="contacto" class="my-5 text-center">
      <h2>¿Necesitas un presupuesto?</h2>
      <p>Contáctanos para recibir una valoración gratuita y sin compromiso.</p>
      <a href="mailto:desbrocespontevedra@mail.com" class="btn btn-success btn-lg">Enviar correo</a>
    </div>

    <!-- Solicitar pago -->
    <div id="payment-section" class="text-center" style="display: none;">
      <h2>Realizar un pago</h2>
      <p id="account">No conectado</p>
      <p id="balance">Balance: 0 ETH</p>
      <input type="number" id="amount" placeholder="Cantidad a enviar (ETH)" min="0.01" disabled />
      <button id="sendBtn" class="btn btn-success" disabled>Enviar Pago</button>
    </div>

    <!-- Botón que activa la conexión a MetaMask -->
    <div id="payment-button" class="text-center">
      <button id="startPaymentBtn" class="btn btn-primary">Solicitar Pago</button>
    </div>
  </div>

  <script>
    // Verificar si MetaMask está instalado
    if (typeof window.ethereum !== 'undefined') {
      console.log('MetaMask está instalado!');
    } else {
      alert('Por favor, instala MetaMask para poder interactuar con esta aplicación.');
    }

    let selectedAccount;

    // Activar sección de pago cuando el usuario hace clic en "Solicitar Pago"
    document.getElementById("startPaymentBtn").addEventListener("click", async () => {
      document.getElementById("payment-section").style.display = 'block'; // Mostrar la sección de MetaMask
      await connectMetaMask(); // Intentar conectar MetaMask
    });

    // Conectar a MetaMask
    async function connectMetaMask() {
      try {
        // Solicitar conexión a MetaMask
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        selectedAccount = accounts[0];
        document.getElementById("account").innerText = `Cuenta conectada: ${selectedAccount}`;
        getBalance(selectedAccount);
      } catch (error) {
        console.error("Error al conectar:", error);
        alert("Error al conectar MetaMask. Asegúrate de que MetaMask está instalado.");
      }
    }

    // Obtener balance de ETH
    async function getBalance(account) {
      const balance = await window.ethereum.request({
        method: 'eth_getBalance',
        params: [account, 'latest'],
      });
      const ether = parseFloat(window.web3.utils.fromWei(balance, 'ether')).toFixed(4);
      document.getElementById("balance").innerText = `Balance: ${ether} ETH`;
      document.getElementById("amount").disabled = false; // Habilitar el campo para ingresar cantidad
      document.getElementById("sendBtn").disabled = false; // Habilitar el botón para enviar
    }

    // Enviar pago
    document.getElementById("sendBtn").addEventListener("click", async () => {
      const amount = document.getElementById("amount").value;
      if (amount && selectedAccount) {
        const tx = {
          to: '0x692018bED36405fD85d9f9531A146cA3b0aE45a0', // Dirección de recepción
          value: window.web3.utils.toHex(window.web3.utils.toWei(amount, 'ether')), // Convertir ETH a wei
        };

        try {
          // Enviar transacción a la dirección
          const txHash = await window.ethereum.request({
            method: 'eth_sendTransaction',
            params: [tx],
          });
          alert(`Pago realizado con éxito! Transacción hash: ${txHash}`);
        } catch (error) {
          console.error("Error al realizar el pago:", error);
          alert("Error al realizar el pago.");
        }
      } else {
        alert("Por favor, ingresa una cantidad y asegúrate de que MetaMask esté conectado.");
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
</body>
</html>

